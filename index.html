<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Tracker</title>
    <!-- added fonts -->
    <link href="https://api.fontshare.com/v2/css?f[]=satoshi@700,500&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Archivo:wght@600;900&display=swap" rel="stylesheet">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JRGB78MPJC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-JRGB78MPJC');
    </script>
    <!-- added style.css -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- NAV -->
    <div class="nav">
        <div>
            <img src="./assets/mingcute_copper-coin-fill.svg" alt="demo-logo">
            <h1 class="nav-title">COINTRACK</h1>
        </div>
        <a href="#" id="teamBtn">Team</a>
    </div>

    <!-- CONTENT -->
    <section class="main-content">
        <!-- dropdown -->
        <div>
            <!-- onchange to chnage data when selected value changes -->
            <!-- <select id="coinsSelect" onchange="getData(this)">
                <option value="" disabled selected>Select a coin</option>
                <option value="bitcoin">Bitcoin</option>
                <option value="ethereum">Ethereum</option>
                <option value="tether">Tether</option>
                <option value="cardano">Cardano</option>
                <option value="solana">Solana</option>
                <option value="dogecoin">Doge</option>
            </select>
            <table class="table table-striped table-bordered">
                <tr>
                    <td class="">Name</td>
                    <td id="name" class=""></td>
                </tr>
                <tr>
                    <td class="">Price</td>
                    <td class="" id="price"></td>
                </tr>
                <tr>
                    <td class="">Volume</td>
                    <td class="" id="volume"></td>
                </tr>
                <tr>
                    <td class="">Change (24 Hrs)</td>
                    <td class="" id="change1d"></td>
                </tr>
                <tr>
                    <td class="">Last Refresh</td>
                    <td class="" id="last"></td>
                </tr>
                <tr>
                    <td class="">Refresh in</td>
                    <td class="" id="refresh"></td>
                </tr>
            </table> -->
            <div class="select">
                <div class="selectBtn" data-type="firstOption">Select</div>
                <div class="selectDropdown">
                    <div class="option" data-type="bitcoin">Bitcoin</div>
                    <div class="option" data-type="ethereum">Ethereum</div>
                    <div class="option" data-type="tether">Tether</div>
                    <div class="option" data-type="cardano">Cardano</div>
                    <div class="option" data-type="solana">Solana</div>
                    <div class="option" data-type="dogecoin">Doge Coin</div>
                </div>
            </div>

            <table class="table table-striped table-bordered">
                <tr>
                    <td class="">Name</td>
                    <td id="name" class=""></td>
                </tr>
                <tr>
                    <td class="">Price</td>
                    <td class="" id="price"></td>
                </tr>
                <tr>
                    <td class="">Volume</td>
                    <td class="" id="volume"></td>
                </tr>
                <tr>
                    <td class="">Change (24 Hrs)</td>
                    <td class="" id="change1d"></td>
                </tr>
                <tr>
                    <td class="">Last Refresh</td>
                    <td class="" id="last"></td>
                </tr>
                <tr>
                    <td class="">Refresh in</td>
                    <td class="" id="refresh"></td>
                </tr>
            </table>


        </div>
    </section>

    
    
</body>
<script>const select = document.querySelectorAll('.selectBtn');
    const option = document.querySelectorAll('.option');
    let index = 1;
    
    select.forEach(a => {
        a.addEventListener('click', b => {
            const next = b.target.nextElementSibling;
            next.classList.toggle('toggle');
            next.style.zIndex = index++;
        })
    })
    option.forEach(a => {
        a.addEventListener('click', b => {
            b.target.parentElement.classList.remove('toggle');
            
            const parent = b.target.closest('.select').children[0];
            parent.setAttribute('data-type', b.target.getAttribute('data-type'));
            parent.innerText = b.target.innerText;
        })
    })</script>

<script type="text/javascript">
    // funciton to fetch data
    function getData(selectBtn) {
        if (upd) {
            clearInterval(upd);
        }
        let coin = selectBtn.data-type;
        fetchApi(coin);
        counter();
    }
    let upd;
    let count = 0;

    function fetchApi(coin) {
        count = 0;
        $.ajax({
            url: `https://api.coinstats.app/public/v1/coins/${coin}?currency=INR`,
            type: "GET",
            async: false,
            dataType: 'json',
            success: (data) => {
                console.log(data.coin);
                let date = new Date();
                document.getElementById('name').innerHTML = `<img height="20" src="${data.coin.icon}">&nbsp${data.coin.name} (${data.coin.symbol})`;
                //added toFixed(3) to round off to 3 decimal places
                document.getElementById('price').innerHTML = 'â‚¹' + data.coin.price.toFixed(3);
                document.getElementById('volume').innerHTML = data.coin.volume.toFixed(3);
                let change1d = document.getElementById('change1d');
                change1d.innerHTML = `<b>${data.coin.priceChange1d}</b>`;
                document.getElementById('last').innerHTML = `${date.getDate()}/${date.getMonth()}/${date.getFullYear()} &nbsp; ${date.getHours()}:${date.getMinutes()}:${date.getSeconds()} `;
                if (data.coin.priceChange1d >= 0) {
                    change1d.style.color = "green";
                } else {
                    change1d.style.color = "red";
                }
            },
            error: (error) => {
                console.log(error);
            }

        });
        upd = setTimeout(() => {
            fetchApi(coin);
            count = 0;
        }, 30000);


    }

    fetchApi('bitcoin');

    function counter() {

        setTimeout(() => {
            if(count<30){
                document.getElementById('refresh').innerHTML = `${30 - count++} second`;
                counter();
            }
            
        }, 1000);
    }
    counter();
        
    
</script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous">
</script>

<!-- custom select -->
<script>
    var x, i, j, l, ll, selElmnt, a, b, c;
    /*look for any elements with the class "custom-select":*/
    x = document.getElementsByClassName("custom-select");
    l = x.length;
    for (i = 0; i < l; i++) {
      selElmnt = x[i].getElementsByTagName("select")[0];
      ll = selElmnt.length;
      /*for each element, create a new DIV that will act as the selected item:*/
      a = document.createElement("DIV");
      a.setAttribute("class", "select-selected");
      a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
      x[i].appendChild(a);
      /*for each element, create a new DIV that will contain the option list:*/
      b = document.createElement("DIV");
      b.setAttribute("class", "select-items select-hide");
      for (j = 1; j < ll; j++) {
        /*for each option in the original select element,
        create a new DIV that will act as an option item:*/
        c = document.createElement("DIV");
        c.innerHTML = selElmnt.options[j].innerHTML;
        c.addEventListener("click", function(e) {
            /*when an item is clicked, update the original select box,
            and the selected item:*/
            var y, i, k, s, h, sl, yl;
            s = this.parentNode.parentNode.getElementsByTagName("select")[0];
            sl = s.length;
            h = this.parentNode.previousSibling;
            for (i = 0; i < sl; i++) {
              if (s.options[i].innerHTML == this.innerHTML) {
                s.selectedIndex = i;
                h.innerHTML = this.innerHTML;
                y = this.parentNode.getElementsByClassName("same-as-selected");
                yl = y.length;
                for (k = 0; k < yl; k++) {
                  y[k].removeAttribute("class");
                }
                this.setAttribute("class", "same-as-selected");
                break;
              }
            }
            h.click();
        });
        b.appendChild(c);
      }
      x[i].appendChild(b);
      a.addEventListener("click", function(e) {
          /*when the select box is clicked, close any other select boxes,
          and open/close the current select box:*/
          e.stopPropagation();
          closeAllSelect(this);
          this.nextSibling.classList.toggle("select-hide");
          this.classList.toggle("select-arrow-active");
        });
    }
    function closeAllSelect(elmnt) {
      /*a function that will close all select boxes in the document,
      except the current select box:*/
      var x, y, i, xl, yl, arrNo = [];
      x = document.getElementsByClassName("select-items");
      y = document.getElementsByClassName("select-selected");
      xl = x.length;
      yl = y.length;
      for (i = 0; i < yl; i++) {
        if (elmnt == y[i]) {
          arrNo.push(i)
        } else {
          y[i].classList.remove("select-arrow-active");
        }
      }
      for (i = 0; i < xl; i++) {
        if (arrNo.indexOf(i)) {
          x[i].classList.add("select-hide");
        }
      }
    }
    /*if the user clicks anywhere outside the select box,
    then close all select boxes:*/
    document.addEventListener("click", closeAllSelect);
    </script>

</html>
